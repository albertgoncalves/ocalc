#!/usr/bin/env bash

set -eu

build () {
    home=$(pwd)
    cd $WD/src/
    if [ ! -f parser.messages ]; then
        menhir --list-errors parser.mly > parser.messages
    fi
    menhir --compile-errors parser.messages parser.mly > messages.ml
    ocamlbuild \
        -use-ocamlfind \
        -use-menhir \
        -menhir "menhir --table" \
        -package menhirLib \
        main.byte
    mv main.byte $WD/bin/main.byte
    cd $home
}

build
rlwrap $WD/bin/main.byte
