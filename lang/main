#!/usr/bin/env bash

set -eu

build () {
    home=$(pwd)
    cd $WD/lang/build
    for x in prelude.ml lexer.mll parser.mly main.ml; do
        cp $WD/lang/src/$x ./$x
    done
    ocamllex lexer.mll
    menhir parser.mly
    ocamlc prelude.ml -c parser.mli
    ocamlc prelude.ml lexer.ml parser.ml main.ml -o $WD/lang/bin/main
    cd $home
}

build
rlwrap $WD/lang/bin/main
